---
import OptimizedImage from './OptimizedImage.astro';

const testimonials = [
  {
    name: "Marie Dubois",
    role: "Élève en guitare",
    image: "/images/marie.webp",
    quote: "Grâce à Musique Facile, j'ai pu apprendre la guitare à mon rythme. Les cours sont très bien structurés et les explications sont claires. En seulement quelques mois, je peux déjà jouer mes morceaux préférés !",
    rating: 5
  },
  {
    name: "Thomas Martin",
    role: "Élève en piano",
    image: "/images/thomas.webp", 
    quote: "Je cherchais une méthode flexible pour apprendre le piano et j'ai trouvé exactement ce qu'il me fallait. La progression est bien pensée et le support est très réactif. Je recommande vivement !",
    rating: 5
  }
];

const stats = [
  {
    number: "80,000+",
    label: "Étudiants formés"
  },
  {
    number: "95%",
    label: "Taux de satisfaction"
  },
  {
    number: "1400+",
    label: " vidéos disponibles"
  }
];

// Schema.org Review pour chaque témoignage
const reviewSchemas = testimonials.map(testimonial => ({
  "@context": "https://schema.org",
  "@type": "Review",
  "author": {
    "@type": "Person",
    "name": testimonial.name
  },
  "reviewRating": {
    "@type": "Rating",
    "ratingValue": testimonial.rating.toString(),
    "bestRating": "5",
    "worstRating": "1"
  },
  "reviewBody": testimonial.quote,
  "itemReviewed": {
    "@type": "EducationalOrganization",
    "name": "Musique Facile",
    "url": "https://musique-facile.fr"
  },
  "datePublished": new Date().toISOString().split('T')[0]
}));
---

<!-- Schema.org Review pour chaque témoignage -->
{reviewSchemas.map(schema => (
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />
))}

<section class="testimonials">
  <div class="container">
    <h2 class="section-title">Ce que nos élèves disent de nous</h2>
    <p class="section-subtitle">Découvrez les retours d'expérience de nos étudiants satisfaits</p>

    <div class="testimonials-grid">
      {testimonials.map(testimonial => (
        <div class="testimonial-card">
          <div class="testimonial-header">
            <OptimizedImage
              src={testimonial.image}
              alt={`Photo de ${testimonial.name}, élève satisfait de Musique Facile`}
              width={80}
              height={80}
              loading="lazy"
              class="testimonial-image"
            />
            <div class="testimonial-meta">
              <h3>{testimonial.name}</h3>
              <p class="testimonial-role">{testimonial.role}</p>
              <div class="testimonial-rating">
                {Array.from({ length: testimonial.rating }).map(() => (
                  <span class="star">⭐</span>
                ))}
              </div>
            </div>
          </div>
          <blockquote class="testimonial-quote">
            "{testimonial.quote}"
          </blockquote>
        </div>
      ))}
    </div>

    <div class="stats-container">
      {stats.map(stat => (
        <div class="stat-item">
          <div class="stat-number">{stat.number}</div>
          <div class="stat-label">{stat.label}</div>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  .testimonials {
    padding: var(--space-20) 0;
    background: linear-gradient(180deg, var(--surface-white) 0%, var(--surface-light) 100%);
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-6);
  }

  .section-title {
    text-align: center;
    font-size: clamp(var(--text-3xl), 4vw, var(--text-5xl));
    font-weight: var(--font-extrabold);
    margin-bottom: var(--space-4);
    color: var(--gray-900);
    line-height: var(--leading-tight);
  }

  .section-subtitle {
    text-align: center;
    font-size: var(--text-lg);
    color: var(--gray-600);
    line-height: var(--leading-relaxed);
    max-width: 600px;
    margin: 0 auto var(--space-16);
  }

  .testimonials-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-8);
    margin-bottom: var(--space-16);
  }

  .testimonial-card {
    position: relative;
    background: white;
    border-radius: var(--radius-2xl);
    padding: var(--space-8);
    box-shadow: var(--shadow-sm);
    border: 2px solid var(--gray-200);
    transition: var(--transition-base);
    overflow: hidden;
  }

  .testimonial-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--brand-500);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform var(--duration-base) var(--ease-out);
  }

  .testimonial-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-xl);
    border-color: var(--brand-300);
  }

  .testimonial-card:hover::before {
    transform: scaleX(1);
  }

  .testimonial-header {
    display: flex;
    align-items: center;
    gap: var(--space-6);
    margin-bottom: var(--space-6);
  }

  .testimonial-image,
  .testimonial-image :global(.optimized-image-wrapper) {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    overflow: hidden;
  }

  .testimonial-image :global(.optimized-image) {
    border: 3px solid var(--brand-500);
    border-radius: 50%;
  }

  .testimonial-meta h3 {
    font-size: var(--text-xl);
    font-weight: var(--font-bold);
    margin: 0 0 var(--space-1);
    color: var(--gray-900);
  }

  .testimonial-role {
    font-size: var(--text-sm);
    color: var(--gray-600);
    margin: 0 0 var(--space-2);
  }

  .testimonial-rating {
    display: flex;
    gap: var(--space-1);
  }

  .star {
    font-size: 1rem;
  }

  .testimonial-quote {
    font-size: var(--text-lg);
    line-height: var(--leading-relaxed);
    color: var(--gray-700);
    margin: 0;
    font-style: italic;
  }

  .stats-container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-8);
    background: linear-gradient(135deg, var(--brand-500), var(--brand-600));
    padding: var(--space-12);
    border-radius: var(--radius-2xl);
    margin-top: var(--space-16);
    text-align: center;
    color: white;
    box-shadow: var(--shadow-brand);
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
  }

  .stat-number {
    font-size: clamp(var(--text-4xl), 4vw, var(--text-5xl));
    font-weight: var(--font-extrabold);
    line-height: var(--leading-tight);
  }

  .stat-label {
    font-size: var(--text-lg);
    opacity: 0.95;
  }

  @media (max-width: 768px) {
    .testimonials-grid {
      grid-template-columns: 1fr;
    }

    .stats-container {
      grid-template-columns: 1fr;
      padding: var(--space-8);
    }

    .testimonial-card {
      padding: var(--space-6);
    }

    .testimonial-header {
      flex-direction: column;
      text-align: center;
    }

    .testimonial-meta {
      text-align: center;
    }

    .testimonial-rating {
      justify-content: center;
    }
  }
</style>